<HTML>

<HEAD>
<TITLE>Angband -- Changes</TITLE>
</HEAD>

<BODY>

<H1>Angband -- Changes</H1>

<P>
This page lists "changes" in older versions of
<A HREF="http://www.phial.com/angband/">Angband</A>.
</P>

<H2>Table of Contents</H2>

<UL>
  <LI><A HREF="#A281">Changes made for Angband 2.8.1</A></LI>
  <LI><A HREF="#A280">Changes made for Angband 2.8.0</A></LI>
</UL>

<HR>



<A NAME="A281"></A>

<H2>Changes made for Angband 2.8.1</H2>

<UL>
  <LI>
    The "use_sound" and "use_graphics" flags were restored,
    but must be set by "main-xxx.c" files which support them
    based on the "arg_sound" and "arg_graphics" flags.
  </LI>
  <LI>
    Some more sound support has been added.
  </LI>
  <LI>
    The "player sex" concept was genericized into a table.
  </LI>
  <LI>
    Monster death and chest death now use "drop_near()".
  </LI>
  <LI>
    The "drop_near()" function was changed to use a "better"
    method for determining where an object should fall, and
    it seems to work well with the new "stacking" code.  The
    radius of the drop zone was increased.
  </LI>
  <LI>
    Various "resistance tables" have been added as sub-screens
    of the "character description" screen.
  </LI>
  <LI>
    The race/class restrictions have been relaxed, and "illegal"
    combinations are labelled "for advanced players only".
  </LI>
  <LI>
    Some onscreen instructions have been added to "birth.c"
    for display during initial player creation.
  </LI>
  <LI>
    The "z-term.c" package has been optimized (again), causing
    some changes.  The "Term->pict_hook" function now takes a
    length, an array of attrs and an array of chars, instead
    of a single attr and char.  The "Term->text_hook" function
    still takes a "string", but it is no longer "null-terminated".
    The "cursor" is now erased and redrawn on every non-trivial
    refresh.  Trivial refresh calls now have no effect.
  </LI>
  <LI>
    The old "use_sound" and "use_graphics" flags have been
    changed to "arg_sound" and "arg_graphics", and now have
    the semantics that the user has requested the use of sound
    or graphics.  These flags are ignored by the game itself,
    and now the appropriate "main-xxx.c" file must interpret
    these flags "correctly" (or ignore them).
  </LI>
  <LI>
    Macintosh Angband now supports basic "graphics" (using
    the same pixmap array as Amiga Angband), allows each
    window to be scaled to any desired size, allows the use
    of non-mono-spaced fonts, and supports simple "sounds".
  </LI>
  <LI>
    The "main-x11.c" and "main-xaw.c" files have been fixed.
  </LI>
  <LI>
    Whenever the "r" key may be used to activate on-screen monster
    recall, it may also be used to disable this on-screen recall.
  </LI>
  <LI>
    Searching will no longer find "traps" on non-chest objects.
  </LI>
  <LI>
    Cheating death no longer induces screen weirdness.
  </LI>
  <LI>
    Leaving a store no longer induces screen weirdness.
  </LI>
  <LI>
    Pack overflow is now handled at the start of the players
    turn, not the end, which has various subtle effects.
  </LI>
  <LI>
    A new monster flag was introduced to force "nasty" monsters
    to refrain from using spell attacks until the player has had
    a chance to react to their birth.
  </LI>
  <LI>
    A new monster flag was introduced to prevent monsters from
    being processed during the turn of their birth.  This allowed
    the removal of the "m_fast" and "o_fast" arrays, and some code.
  </LI>
  <LI>
    The "other_query" option is now used exclusively to activate
    verification of "use object on ground" commands, which can be
    used to select objects from the middle of object stacks.  The
    default behavior is to accept the top-most acceptable object.
  </LI>
  <LI>
    Stacks of objects on the dungeon floor, and monsters carrying
    objects, are now stored in the savefile, but the "order" of
    the objects in both stacks in not currently maintained.
  </LI>
  <LI>
    Monsters can now "carry" objects if a special "testing" option
    is activated.  Looking at a monster described all of objects
    being carried by the monster.  When a monster dies, all of the
    objects being carried are dropped in the monster grid before
    the standard monster drop is calculated.  When a monster is
    deleted, all objects being carried are deleted as well.  Any
    objects picked up or stolen by the monster will be carried.
  </LI>
  <LI>
    Objects can now "stack" on the ground if a special "testing"
    option is activated.  Looking at a stack of objects describes
    each object in turn.  The map displays the picture of the
    uppermost "memorized" object in each grid, if any.
  </LI>
  <LI>
    Objects may now "combine" on the ground with similar objects
    when they are dropped into the same grid.
  </LI>
  <LI>
    Unidentified missiles will no longer stack with identified
    missiles, even if they are identical.
  </LI>
  <LI>
    Objects are no longer restricted to a single rating bonus.
  </LI>
  <LI>
    Inscriptions on store items are removed when purchased.
  </LI>
  <LI>
    Cleaned up the messages involved in taking off equipment.
  </LI>
  <LI>
    Cleaned up the use of "temporary" objects.
  </LI>
  <LI>
    You can no longer drop equipped cursed items in your home.
  </LI>
  <LI>
    Running may work better around closed doors, but more
    investigation is needed.
  </LI>
  <LI>
    The "you are confused" message is now used whenever the
    player specifies a direction but gets a different one.
  </LI>
  <LI>
    The detection spells now "detect" terrain/objects/monsters
    even if they are already "visible" or "detected", and give
    a message about successful detection.  The "door" detection
    spells now detect all doors, not just secret doors.  The
    monster detection spells now make every detected monster
    "visible" for one player turn.
  </LI>
  <LI>
    Using the "finder" string now activates the "shower" string,
    and the "shower" string now hilites only the matching portion
    of each line, if any.
  </LI>
  <LI>
    A problem with the interactive creation of new macros using
    "main-x11.c" or "main-xaw.c" has been repaired.
  </LI>
  <LI>
    The player's current mana/hitpoints are no longer adjusted when
    the maximum mana/hitpoints change, except to enforce maximum
    limits.  Among other things, gaining a level no longer raises
    the player's current mana/hitpoints immediately.  This prevents
    some bizarre implications of the old adjustment semantics.
  </LI>
  <LI>
    The "target" and "look" commands have been combined.  Both allow
    the user to "examine" nearby "interesting" grids (or all grids),
    setting a target if desired.  The "target" command requires grids
    to contain "targetable" monsters to be considered interesting, and
    uses the "space" key to jump immediately to the next "interesting"
    grid, instead of furthur examining the grid containing the monster.
    The "return" key will always step through the description (forever),
    and the "+" key will always jump to the next "interesting" grid.
  </LI>
  <LI>
    The monster recall window is now maintained in a more intelligent
    manner.  Whenever the player attacks a single monster, that monster
    race will be auto-recalled.  Note that player spells which affect
    multiple monsters, or which work by affecting all monsters in line
    of sight (even if only a single monster is thus affected), will not
    trigger auto-recall.  The "monster recall window" is now updated
    whenever "interesting" information (flags, attacks, spells) is
    learned by the player while the monsters are being processed.
  </LI>
  <LI>
    Scrolls/Staffs of darkness now blind before bringing darkness.
  </LI>
  <LI>
    The messages about remaining spells/prayers to be learned are
    now more detailed and correctly pluralized.
  </LI>
  <LI>
    It is no longer possible to accidentally accept a shop-keepers
    initial (non-final) offer by hitting return.
  </LI>
  <LI>
    The player now gets experience from killing monsters based on
    his "maximum" player level, not the "current" player level.
  </LI>
  <LI>
    All artifact activations now include a brief visual description.
  </LI>
  <LI>
    Inability to create a glyph of warding is now mentioned.
  </LI>
  <LI>
    Scrolls of identify/recharging/enchantment no longer describe
    themselves when they are read.
  </LI>
  <LI>
    The "stat display" now indicates which stats cannot be improved
    by quaffing stat potions, using a "bang" instead of a "colon".
  </LI>
  <LI>
    There is an optional "pref-gcu.prf" file which allows basic use
    of the standard VT100 keypad keys and arrow keys.
  </LI>
  <LI>
    The basic "tunnel" command is now selected using "T" (or "^T"
    in the roguelike command set) if needed.  The standard "open"
    and "disarm" commands must be used on chests, and the standard
    "bash" command may be used on locked doors.
  </LI>
  <LI>
    The "+" keypress (as well as the various "control" combinations
    such as control-direction or control-keypad, which map to the "+"
    keypress) is now a new "alter" command, which will take a direction,
    and perform the "obvious" command that direction, that is, attack
    monsters, tunnel into walls (or veins or rubble), disarm traps,
    bash jammed doors, open closed (or locked) doors.  This command
    always takes a full turn, and will have no effect if there is no
    "obvious" command, in particular, this command will only induce
    movement when used to bash jammed doors or disarm traps, so it can
    be used to attack adjacent grids without moving into those grids.
  </LI>
  <LI>
    Opening doors now takes energy.
  </LI>
  <LI>
    The sub-window processing has been optimized, especially for
    the cases when they are not being actively used.
  </LI>
  <LI>
    The "display objects" window option is now used to allow an
    object kind to be "recalled" in a window.  Currently, this is
    used to provide the old "display spell choices" functionality,
    using the same display code as the "browse" command, with the
    browse, study, cast, and pray commands auto-tracking whichever
    book is used with the command.
  </LI>
  <LI>
    Wearing unidentified artifacts no longer allows artifact
    identity detection via the "list artifacts" command.
  </LI>
  <LI>
    Direction "5" is no longer accepted for commands such as "run"
    or "close", so running in place is no longer a fatal error,
    and in fact, "5" acts like "escape" for these commands.
  </LI>
  <LI>
    Creating a character dump no longer messes up the screen.
  </LI>
  <LI>
    The "shower" hiliting in "files.c" has been repaired.
  </LI>
  <LI>
    Digestion can no longer be negative or non-existant.
  </LI>
  <LI>
    Changing the terrain feature of a grid has been made into
    a general function, catching some weirdness involving things
    like the memorization of new glyphs of warding in dark rooms.
  </LI>
  <LI>
    Several spoiler files have been updated.  New directories have
    been created at the ftp site for help files and spoiler files.
  </LI>
</UL>

<HR>


<A NAME="A280"></A>

<H2>Changes made for Angband 2.8.0</H2>

<UL>
  <LI>
    Use "Rand_div()" instead of the faster but less random "Rand_mod()",
    and save the RNG state in the savefile.
  </LI>
  <LI>
    New methods are needed for loading/saving savefiles with the new
    terrain feature flags, and to save normal options and window options
    so that future option changes will not cause trouble.
  </LI>
  <LI>
    Messages are now memorized as complete strings.  The message recall
    window shows one message per line, using the '4' and '6' keys to
    "slide" the viewing area left and right to view long messages.
  </LI>
  <LI>
    The "look" command now starts on the player.
  </LI>
  <LI>
    Monsters are now healed when they drain charges from the pack.
  </LI>
  <LI>
    The "options" interface was cleaned up somewhat.
  </LI>
  <LI>
    The "z-term.c" function was optimized and verified some more.
  </LI>
  <LI>
    Object destruction now uses correct pluralization rules.
  </LI>
  <LI>
    The "overhead map window" is redrawn whenever the player moves.
  </LI>
  <LI>
    Stupid monsters now rarely wake up when illuminated.
  </LI>
  <LI>
    Pack combination now performs its own "reorganization", avoiding
    bizarre "rearrangement" messages.
  </LI>
  <LI>
    There is a new function to combine "paths" with "files", which
    allows the use of "absolute filenames" and "tilde filenames" in
    certain situations, such as the "character dump".
  </LI>
  <LI>
    Using a "count" with the "destroy" command will bypass
    "verification" unless the "other_query_flag" option is set.
  </LI>
  <LI>
    The "wield" and "takeoff" commands now use the "w" and "t" keys
    (like the original keyset) for the underlying commands, and the
    "[" and "]" keys are now unused.  The "_" key can now be used to
    enter a store, and walking onto a store generates this "keypress".
    The "ctrl-e" command was replaced by the "ctrl-i" (tab) command,
    to "flip" any "windows" displaying the equipment or inventory.
  </LI>
  <LI>
    There are some new "sub-window flags" which induce various new
    displays in sub-windows, including "recall old messages" and
    "display complete spell list".
  </LI>
  <LI>
    The various "windows" are now handled in a more generic manner,
    using a set of 8 pointers to "term" structures, and, for each,
    a set of "usage" flags, accessable via a new "options" screen,
    which, in combination with the new "p_ptr->window" field, allows
    the game to determine what should be displayed in each window.
  </LI>
  <LI>
    All of the source files were "indented" and cleaned up a bit.
  </LI>
  <LI>
    The "main-mac.c" file was cleaned up quite a bit, and, among other
    things, now allows "monster recall" to "wrap" at the window edges.
  </LI>
  <LI>
    The "resurrection" code now works, and "cheating death" now marks
    your social class as zero (and counts deaths in your age), as well
    as marking your savefile as having cheated death, which disables
    placement on the high-score list.
  </LI>
  <LI>
    There is now a generalized "c_roff()" command, which provides colored,
    word-wrapping, multi-line output, and which is now used for the monster
    recall code, which may thus be "colored" at some point.
  </LI>
  <LI>
    An object inscription of the form "^x" will induce verification of
    the command "x" while the object is being worn.  Inscribing "^;" on
    a shovel will thus prevent attacking (or walking) with the shovel,
    while inscribing "^+" on your weapon will prevent digging with it.
  </LI>
  <LI>
    Several options were added, removed, modified, combined, etc, and
    the "option.txt" helpfile was updated accordingly, so read it.
  </LI>
  <LI>
    New options allow the "look" command to see everything on the current
    panel, and for the "list" commands to "wrap" at the edges of the list,
    and for new "special lighting effects", and for new "optimizations"
    of various things, and for new "disturbance" criteria, etc.
  </LI>
  <LI>
    The "map_info()" function was optimized, and the "special lighting
    effects" were completely rewritten.
  </LI>
  <LI>
    Shop-keeper rotation is no longer optional, and is four times as
    common as before.  Buying the last item from a shop now induces
    a possible shop-keeper rotation, plus the creation of new stock.
  </LI>
  <LI>
    The "feature types" can now take an index of another feature type
    which they should "mimic", allowing the generic "conversion" of
    secret doors into walls, all locked/jammed doors into closed doors,
    all walls into the same wall, and hidden treasure into normal veins.
    Floors and invisible traps often bypass this field for efficiency.
  </LI>
  <LI>
    The general store now buys and sells basic ammunition.
  </LI>
  <LI>
    New object/monster allocation table routines have been written,
    which optimize various things, including the generation of pits
    and nests, and the summon/escort code.  Monster nests now contain
    up to 64 different types of monsters.
  </LI>
  <LI>
    Thrown objects (and fired missiles) now rarely "disappear" unless
    they are thrown at a monster (intentionally or accidentally), or
    if they attempt to land in a crowded area.
  </LI>
  <LI>
    The "inkey()" code was cleaned up somewhat.  The "default action"
    code in the X11 keypress code needs to be tested.
  </LI>
  <LI>
    The hard-coded "feature" codes were replaced with constants, plus
    a few hard-coded "offsets" from the "shop"/"trap"/"door" constants.
  </LI>
  <LI>
    Several fields and variables and such were renamed, primarily to
    migrate from "inven_type *i_ptr" to "object_type *o_ptr", and from
    "fdat" and "ftyp" to "info" and "feat" for cave grids.
  </LI>
  <LI>
    The "delay()" function has been migrated into another "Term_xtra()"
    hook, using the "TERM_XTRA_DELAY" action.  All standard "main-xxx.c"
    files were changed to use the new method.  The "delay_factor" is now
    "cubed" when used to give a better "range" of delay values, ranging
    from a single millisecond to almost a full second.
  </LI>
  <LI>
    Chests are now quite a bit "better" than they used to be.
  </LI>
  <LI>
    The windows no longer continuously "shrink" in the Windows version,
    the pixmaps are not "garbled", and double-clicking savefiles works.
  </LI>
  <LI>
    Ancient "Archimedes Angband 1.2" savefiles can now be parsed.
  </LI>
  <LI>
    Dungeon generation now uses "stack" memory instead of heap memory,
    since the Windows version appeared to be fragmenting memory for no
    apparent reason.
  </LI>
  <LI>
    Artifacts are no longer lost due to "aborted" level generation.
  </LI>
  <LI>
    The "showing" ('=') action (which displays matching lines in yellow),
    and the "finding" ('/') action (which changes the current line), are
    now available in the online help, listing uniques/artifacts, and the
    message recall, and both actions remember "previous" settings.
  </LI>
  <LI>
    Starting a new character should reset the "cheat" options.
  </LI>
  <LI>
    The "main-gcu.c" file needs to play games with "bool" to prevent
    conflicts with various versions of "curses".
  </LI>
  <LI>
    The "polymorph" code was slightly broken.
  </LI>
  <LI>
    Certain versions (DOS, Windows, etc, but not Unix or Macintosh)
    require the "O_BINARY" flag in the "fd_make()" and "fd_open()"
    routines in "util.c" or the "lib/data/*.raw" files get broken.
    Some compilers do not support the "O_CREAT" flag. (?)
  </LI>
</UL>

<HR>



<P>
Go back to the <A HREF="http://www.phial.com/angband/">
Official Angband Home Page</A>
</P>



<ADDRESS>
See also Ben Harrison's Home Page / 
<A HREF="http://www.phial.com/benh/">Ben Harrison</A> / 
<A HREF="mailto:benh@phial.com">benh@phial.com</A>
</ADDRESS>

</BODY>

</HTML>

